{% extends 'gamefolio_app/base.html' %}
{% load tags %}

{% block title_block %}
    Profile
{% endblock %}

{% block body_block %}
<header class="bg-dark py-0"> 
    <div class="container px-5">
        <div class="row gx-5 align-items-center justify-content-center">
            <div class="col-lg-8 col-xl-7 col-xxl-6">
                <div class="my-5 text-center text-xl-start">
                    <h1 class="display-5 fw-bolder text-white mb-2">
                        {{ selected_user.username }}'s Profile
                        <p class="lead fw-normal text-white-50 mb-4"> - <a href="{{ user_profile.website }}" class="text-white">{{ user_profile.website }}</a></small>
                        <p class="lead fw-normal text-white-50 mb-4"> {{ user_profile.bio }}</a></small>
                    </h1>
                </div>
            </div>
            <div class="col-xl-5 col-xxl-6 d-none d-xl-block text-center">
                <img class="header-image-fixed rounded-3 my-5" src="{{ MEDIA_URL }}{{ user_profile.picture }}" alt="{{ selected_user.username }}'s profile image" />
            </div>
        </div>
    </div>
</header>

<!-- Edit Profile -->
{% if selected_user == user %}
<section class="py-5">
    <div class="container px-5 my-0">
        <div class="row gx-5 justify-content-center">
            <div class="col-lg-8 col-xl-6">
                <div class="text-center">
                    <h2 class="fw-bolder">Edit Your Profile</h2>
                </div>
            </div>
        </div>
        <div class="row gx-5 d-flex justify-content-left">
            <div class="col-md-6 offset-md-3">
                <div class="card">
                    <div class="card-body">
                            <form method="post" action="." enctype="multipart/form-data">
                                {% csrf_token %}
                                {{ form.as_p }}
                                <div class="text-center gap-between-select-and-button">
                                    <button type="submit" class="btn btn-outline-success">Update</button>
                                </div>
                            </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- Lists -->
<section class="py-5">
    <div class="container px-5 my-0">
        <div class="row gx-5 justify-content-center">
            <div class="col-lg-8 col-xl-6">
                <div class="text-center">
                    <h2 class="fw-bolder">{{ selected_user.username }}'s Lists</h2>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="row gx-5">
                {% if user_lists %}
                    {% for list in user_lists %}
                        <div class="col-lg-4 col-md-6 mt-3">  
                            <div class="card h-100 shadow border-0">
                                <div class="card-body p-4 d-flex flex-column">
                                    <h5 class="card-title mb-3">
                                        <a class="game-review-link" href="{% url 'gamefolio_app:list' list.author.user.username list.title list.slug %}">
                                            {{ list.title }}
                                        </a>
                                    </h5>
                                    <p class="card-text mb-auto">{{ list.description|truncatechars:75 }}</p>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p>No lists available.</p>
                {% endif %}

        </div>
    </div>
</section>

<!-- Reviews -->
<section class="py-5">
    <div class="container px-5 my-5">
        <div class="row gx-5 justify-content-center">
            <div class="col-lg-8 col-xl-6">
                <div class="text-center">
                    <h2 class="fw-bolder">{{ selected_user.username }}'s Reviews</h2>
                </div>
            </div>
        </div>

        <br/>
        <div class="col-lg-4 col-xl-4 text-end">
            <div class="btn-group" role="group" aria-label="Sort reviews">
                <a href="?sort_reviews=recent" class="btn btn-outline-success">Sort by Recent</a>
                <a href="?sort_reviews=liked" class="btn btn-outline-success">Sort by Likes</a>
            </div>
        </div>
        <br/>
        
        <div class="row gx-5">
            {% if user_reviews %}
                {% for review in user_reviews %}
                    <div class="col-lg-3 mb-4">
                        <div class="card h-100 border-0 shadow">
                            <a  href="{% url 'gamefolio_app:game' review.game.id %}">
                                <img class="card-img-top game-review-image" src="{% get_image review.game "cover_big" %}" alt="{{ review.game.title }} thumbnail" />
                            </a>
                            <div class="card-body p-3">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <div class="row-2">
                                            <h6 class="mb-1 fw-semibold text-truncate"><a class="game-review-link" href="{% url 'gamefolio_app:game' review.game.id %}">{{ review.game.title }}</a></h6>
                                            <div style="color: #198754">{{ review.get_rating_display }}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div>{{ review.content|truncatechars:80 }}</div>
                                </div>
                                <div class="small row mt-3">
                                    <div class="col-6 text-muted">{{ review.datePosted }}</div>
                                    <div class="col-6 text-muted text-end">{{ review.likes }} likes</div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <p>No reviews available.</p>
            {% endif %}
        </div>
    </div>
    <!-- Pagination -->
    <form method="get" action="{% url 'gamefolio_app:profile' selected_user.username %}?sort_reviews_by={{ sort_reviews_by }}" id="page-form">
        <ul class="pagination justify-content-center">
            <input type="hidden" name="sort_reviews_by" value="{{ sort_reviews_by }}">
            {% if user_reviews %}
                <!-- Previous Button -->
                {% if current_page > 1%}
                    <li class = "page-item">    
                        <button class="number-button page-link d-sm-none d-none d-md-block" type = "submit" value = {{ current_page|add:"-1"}}><span aria-hidden="true">&laquo;</span></button>
                        </a>
                    </li> 
                {% endif %}
                <!-- Page Numbers -->
                {% for page in pages %}
                    {% if page == "type" %}
                        <li class="page-item col-1"><input id="page-search" class="number-button page-link col-12 g-0 justify-content-center" type="input" placeholder="search"></input></li>
                    {% elif page == current_page %}  
                        <li class="page-item"><button class="number-button page-link active" type = "submit" value = {{ page }}>{{ page }}</button></li>
                    {% else %}
                        <li class="page-item"><button class="number-button page-link d-sm-none d-none d-md-block" type = "submit" value = {{ page }}>{{ page }}</button></li>
                    {% endif %}
                {% endfor %}
                <!-- Next Button -->
                {% if current_page < page_count %}
                <li class = "page-item">    
                    <button class="number-button page-link d-sm-none d-none d-md-block" type = "submit" value = {{ current_page|add:"1"}}><span aria-hidden="true">&raquo;</span></button>
                    </a>
                </li>
                {% endif %}
            {% endif %}
        </ul>
    </form>
        
</section>


{% endblock %}
